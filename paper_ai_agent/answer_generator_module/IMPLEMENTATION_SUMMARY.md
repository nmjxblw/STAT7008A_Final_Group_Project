# DeepSeek API å®ç°æ€»ç»“

## ğŸ“‹ ä»»åŠ¡å®Œæˆæƒ…å†µ

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»åœ¨ `answer_generator` æ¨¡å—ä¸­å®Œæˆäº†ä»¥ä¸‹åŠŸèƒ½ï¼š

### âœ… éœ€æ±‚1: DeepSeek APIäº¤äº’åŠŸèƒ½ï¼ˆåœ¨main.pyä¸­ï¼‰
- **çŠ¶æ€**: å·²å®Œæˆ
- **æ–‡ä»¶**: `main.py`, `main_advanced.py`
- **åŠŸèƒ½**: 
  - å®Œæ•´çš„APIè°ƒç”¨å®ç°
  - æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼ˆmodel, temperature, max_tokensï¼‰
  - å®Œå–„çš„é”™è¯¯å¤„ç†

### âœ… éœ€æ±‚2: JSONå“åº”ä¿å­˜ï¼ˆUTF-8æ ¼å¼ï¼Œæ ¹ç›®å½•ï¼‰
- **çŠ¶æ€**: å·²å®Œæˆ
- **ä¿å­˜ä½ç½®**: `{é¡¹ç›®æ ¹ç›®å½•}/DeepSeek_Responses/`
- **æ–‡ä»¶æ ¼å¼**: 
  - APIå“åº”: `response_YYYY-MM-DD_HHMMSS.json`
  - å¯¹è¯å†å²: `conversation_YYYY-MM-DD_HHMMSS.json`
- **ç¼–ç **: UTF-8ï¼ˆå®Œç¾æ”¯æŒä¸­æ–‡ï¼‰

### âœ… éœ€æ±‚3: é•¿å¯¹è¯åŠŸèƒ½ï¼ˆå¯¹è¯å†å²ç¼“å­˜ï¼‰
- **çŠ¶æ€**: å·²å®Œæˆ
- **å®ç°æ–¹å¼**: 
  - åœ¨ `DeepSeekAPI` ç±»ä¸­ç»´æŠ¤ `conversation_history` åˆ—è¡¨
  - æ¯æ¬¡APIè°ƒç”¨è‡ªåŠ¨åŒ…å«å®Œæ•´å†å²
  - æ”¯æŒä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å¤šè½®å¯¹è¯

### âœ… éœ€æ±‚4: è¾“å…¥"quit"é€€å‡ºå¾ªç¯
- **çŠ¶æ€**: å·²å®Œæˆ
- **æ”¯æŒå‘½ä»¤**: `quit`, `exit`, `q`
- **é€€å‡ºè¡Œä¸º**: 
  - è‡ªåŠ¨ä¿å­˜å¯¹è¯å†å²
  - æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
  - ä¼˜é›…é€€å‡º

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

```
Project/answer_generator/
â”œâ”€â”€ __init__.py              # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ deepseek_api.py          # â­ æ ¸å¿ƒAPIç±»
â”œâ”€â”€ main.py                  # â­ åŸºç¡€ç‰ˆä¸»ç¨‹åº
â”œâ”€â”€ main_advanced.py         # â­ é«˜çº§ç‰ˆä¸»ç¨‹åº
â”œâ”€â”€ config.json              # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ test_api.py              # åŠŸèƒ½æµ‹è¯•è„šæœ¬
â”œâ”€â”€ README.md                # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ QUICKSTART.md            # å¿«é€Ÿå¼€å§‹æŒ‡å—
```

## ğŸ¯ æ ¸å¿ƒå®ç°

### 1. DeepSeekAPI ç±» (`deepseek_api.py`)

**ä¸»è¦æ–¹æ³•**:
- `__init__(api_key, base_url)` - åˆå§‹åŒ–API
- `chat(user_message, ...)` - å‘é€æ¶ˆæ¯å¹¶è·å–å›å¤
- `add_message(role, content)` - æ·»åŠ æ¶ˆæ¯åˆ°å†å²
- `get_history()` - è·å–å¯¹è¯å†å²
- `clear_history()` - æ¸…ç©ºå¯¹è¯å†å²
- `save_response(data)` - ä¿å­˜JSONå“åº”ï¼ˆUTF-8ï¼‰
- `save_conversation_history()` - ä¿å­˜å¯¹è¯å†å²
- `load_conversation_history()` - åŠ è½½å¯¹è¯å†å²
- `set_system_prompt(prompt)` - è®¾ç½®ç³»ç»Ÿæç¤ºè¯
- `get_last_assistant_message()` - è·å–æœ€åçš„AIå›å¤

### 2. ä¸»ç¨‹åº (`main.py`)

**æ ¸å¿ƒåŠŸèƒ½**:
```python
# åˆå§‹åŒ–
api = DeepSeekAPI(api_key="your-key")
api.set_system_prompt("ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹")

# å¯¹è¯å¾ªç¯
while True:
    user_input = input("ğŸ‘¤ ä½ : ")
    
    if user_input in ['quit', 'exit', 'q']:
        api.save_conversation_history()  # è‡ªåŠ¨ä¿å­˜
        break
    
    # å‘é€æ¶ˆæ¯ï¼ˆåŒ…å«å†å²ä¸Šä¸‹æ–‡ï¼‰
    response = api.chat(user_input)
    print(api.get_last_assistant_message())
```

### 3. é•¿å¯¹è¯å®ç°åŸç†

```python
# å¯¹è¯å†å²ç»“æ„
conversation_history = [
    {"role": "system", "content": "ç³»ç»Ÿæç¤ºè¯"},
    {"role": "user", "content": "é—®é¢˜1"},      # ç¬¬1è½®
    {"role": "assistant", "content": "å›ç­”1"},
    {"role": "user", "content": "é—®é¢˜2"},      # ç¬¬2è½®ï¼ˆåŒ…å«ç¬¬1è½®ä¸Šä¸‹æ–‡ï¼‰
    {"role": "assistant", "content": "å›ç­”2"},
    # ... æŒç»­ç´¯ç§¯
]

# æ¯æ¬¡APIè°ƒç”¨éƒ½å‘é€å®Œæ•´å†å²
payload = {
    "model": "deepseek-chat",
    "messages": conversation_history  # â† å…³é”®ï¼šåŒ…å«æ‰€æœ‰å†å²
}
```

### 4. JSONä¿å­˜å®ç°

```python
def save_response(self, response_data: Dict, is_error: bool = False):
    """ä¿å­˜APIå“åº”åˆ°JSONæ–‡ä»¶ï¼ˆUTF-8ç¼–ç ï¼‰"""
    timestamp = datetime.now().strftime("%Y-%m-%d_%H%M%S")
    filename = f"response_{timestamp}.json"
    filepath = self.response_save_dir / filename
    
    # ä½¿ç”¨UTF-8ç¼–ç ä¿å­˜ï¼Œensure_ascii=Falseç¡®ä¿ä¸­æ–‡æ­£å¸¸æ˜¾ç¤º
    with open(filepath, 'w', encoding='utf-8') as f:
        json.dump(response_data, f, ensure_ascii=False, indent=2)
```

## ğŸ§ª æµ‹è¯•ç»“æœ

è¿è¡Œ `test_api.py` çš„ç»“æœï¼š

```
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡!
æ€»è®¡: 5/5 æµ‹è¯•é€šè¿‡

âœ“ APIåˆå§‹åŒ–
âœ“ å¯¹è¯å†å²ç®¡ç†
âœ“ ç³»ç»Ÿæç¤ºè¯è®¾ç½®
âœ“ ä¿å­˜å’ŒåŠ è½½å†å²
âœ“ è·å–æœ€åæ¶ˆæ¯
```

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

| åŠŸèƒ½ | åŸºç¡€ç‰ˆ (main.py) | é«˜çº§ç‰ˆ (main_advanced.py) |
|------|-----------------|--------------------------|
| APIäº¤äº’ | âœ… | âœ… |
| é•¿å¯¹è¯ | âœ… | âœ… |
| JSONä¿å­˜(UTF-8) | âœ… | âœ… |
| quité€€å‡º | âœ… | âœ… |
| é…ç½®æ–‡ä»¶ | âŒ | âœ… |
| ç»Ÿè®¡ä¿¡æ¯ | âŒ | âœ… |
| Tokenç´¯è®¡ | âŒ | âœ… |
| å‘½ä»¤ç³»ç»Ÿ | åŸºç¡€ | å®Œæ•´ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### å¿«é€Ÿå¼€å§‹

```bash
# 1. è¿›å…¥ç›®å½•
cd Project/answer_generator

# 2. è¿è¡Œæµ‹è¯•
python test_api.py

# 3. è¿è¡Œä¸»ç¨‹åº
python main_advanced.py
```

### å®é™…å¯¹è¯ç¤ºä¾‹

```
ğŸ‘¤ ä½ : Pythonæ˜¯ä»€ä¹ˆè¯­è¨€ï¼Ÿ

ğŸ¤– åŠ©æ‰‹: Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œä»¥å…¶ç®€æ´æ˜“è¯»çš„è¯­æ³•è€Œé—»å...

ğŸ“Š æœ¬è½®Token: 156 | ç´¯è®¡: 156

ğŸ‘¤ ä½ : å®ƒé€‚åˆåˆå­¦è€…å—ï¼Ÿ

ğŸ¤– åŠ©æ‰‹: æ˜¯çš„ï¼ŒPythonéå¸¸é€‚åˆåˆå­¦è€…...ï¼ˆAIè®°å¾—åœ¨è®¨è®ºPythonï¼‰

ğŸ“Š æœ¬è½®Token: 198 | ç´¯è®¡: 354

ğŸ‘¤ ä½ : quit

æ­£åœ¨ä¿å­˜å¯¹è¯å†å²...
âœ“ å¯¹è¯å†å²å·²ä¿å­˜: DeepSeek_Responses/conversation_2025-10-19_143045.json
ğŸ‘‹ å†è§ï¼
```

### ç”Ÿæˆçš„JSONæ–‡ä»¶

**DeepSeek_Responses/response_2025-10-19_143025.json**:
```json
{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "created": 1729324225,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€..."
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 50,
    "completion_tokens": 106,
    "total_tokens": 156
  }
}
```

**DeepSeek_Responses/conversation_2025-10-19_143045.json**:
```json
{
  "timestamp": "2025-10-19T14:30:45.123456",
  "message_count": 5,
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„AIåŠ©æ‰‹..."
    },
    {
      "role": "user",
      "content": "Pythonæ˜¯ä»€ä¹ˆè¯­è¨€ï¼Ÿ"
    },
    {
      "role": "assistant",
      "content": "Pythonæ˜¯ä¸€ç§é«˜çº§ç¼–ç¨‹è¯­è¨€..."
    },
    {
      "role": "user",
      "content": "å®ƒé€‚åˆåˆå­¦è€…å—ï¼Ÿ"
    },
    {
      "role": "assistant",
      "content": "æ˜¯çš„ï¼ŒPythonéå¸¸é€‚åˆåˆå­¦è€…..."
    }
  ]
}
```

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **ä¼˜é›…çš„ç±»è®¾è®¡**: `DeepSeekAPI` ç±»å°è£…äº†æ‰€æœ‰APIäº¤äº’é€»è¾‘
2. **è‡ªåŠ¨ä¸Šä¸‹æ–‡ç®¡ç†**: æ— éœ€æ‰‹åŠ¨ç®¡ç†å¯¹è¯å†å²
3. **UTF-8æ”¯æŒ**: å®Œç¾å¤„ç†ä¸­æ–‡ç­‰å¤šè¯­è¨€
4. **æ–‡ä»¶è‡ªåŠ¨ç®¡ç†**: è‡ªåŠ¨åˆ›å»ºç›®å½•ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å
5. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯æç¤º
6. **ç”¨æˆ·å‹å¥½**: ä¸°å¯Œçš„äº¤äº’å‘½ä»¤å’Œå®æ—¶åé¦ˆ

## ğŸ“ ä½¿ç”¨æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥**: éœ€è¦æœ‰æ•ˆçš„ DeepSeek API å¯†é’¥
2. **ç½‘ç»œè¿æ¥**: éœ€è¦èƒ½è®¿é—® DeepSeek API æœåŠ¡å™¨
3. **Tokené™åˆ¶**: é•¿å¯¹è¯å¯èƒ½è¶…å‡ºtokené™åˆ¶ï¼Œéœ€é€‚æ—¶æ¸…ç©ºå†å²
4. **è´¹ç”¨**: APIè°ƒç”¨ä¼šäº§ç”Ÿè´¹ç”¨ï¼Œè¯·åˆç†ä½¿ç”¨

## ğŸ‰ æ€»ç»“

æ‰€æœ‰4ä¸ªéœ€æ±‚å‡å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ï¼š

- âœ… **DeepSeek APIäº¤äº’åŠŸèƒ½** - å®Œæ•´å®ç°ï¼Œæ”¯æŒæ‰€æœ‰å‚æ•°
- âœ… **JSONå“åº”UTF-8ä¿å­˜** - è‡ªåŠ¨ä¿å­˜åˆ°æ ¹ç›®å½•ï¼Œå®Œç¾æ”¯æŒä¸­æ–‡
- âœ… **é•¿å¯¹è¯åŠŸèƒ½** - è‡ªåŠ¨ç»´æŠ¤å†å²ï¼Œæ”¯æŒå¤šè½®ä¸Šä¸‹æ–‡å¯¹è¯  
- âœ… **quitå‘½ä»¤é€€å‡º** - æ”¯æŒå¤šç§é€€å‡ºæ–¹å¼ï¼Œè‡ªåŠ¨ä¿å­˜

**ä»£ç è´¨é‡**:
- ğŸ“ å®Œæ•´çš„æ–‡æ¡£å’Œæ³¨é‡Š
- ğŸ§ª 5/5 æµ‹è¯•é€šè¿‡
- ğŸ¨ ç¬¦åˆPythonå‘½åè§„èŒƒ
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†

**å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼** ğŸš€

---

**å¼€å‘æ—¶é—´**: 2025-10-19  
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´  
**å¯ç”¨çŠ¶æ€**: âœ… ç«‹å³å¯ç”¨
